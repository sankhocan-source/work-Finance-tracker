<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Work Schedule Tracker Pro</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Inter,sans-serif;background:linear-gradient(135deg,#0f0f1e,#1a1a2e);color:#fff}
.card{background:rgba(255,255,255,.08);backdrop-filter:blur(10px);border-radius:16px;padding:20px}
</style>
</head>

<body class="min-h-screen">
<div class="max-w-5xl mx-auto space-y-6 px-4 py-6">

<h1 class="text-3xl font-bold">Work Schedule Tracker ‚Äì Pro</h1>

<div class="card flex flex-col sm:flex-row gap-3 justify-between">
<button onclick="resetCurrent()" class="bg-yellow-500 px-4 py-2 rounded">Reset Current Shift</button>
<div id="userInfo" class="opacity-80">Not logged in</div>
<div class="flex gap-2">
<button onclick="googleLogin()" class="bg-indigo-500 px-4 py-2 rounded">Google Login</button>
<button onclick="logout()" class="bg-red-500 px-4 py-2 rounded">Logout</button>
</div>
</div>

<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
<div class="card text-center"><p>Total Shifts</p><p id="totalShifts" class="text-2xl">0</p></div>
<div class="card text-center"><p>Total Time</p><p id="totalTime" class="text-2xl">00:00:00</p></div>
<div class="card text-center"><p>Today Time</p><p id="todayTime" class="text-2xl">00:00:00</p></div>
</div>

<div id="active" class="card hidden">
<h2>Active Shift</h2>
<div id="timer" class="text-4xl">00:00:00</div>
<div class="flex gap-2 mt-3 flex-wrap">
<button onclick="pauseShift()" class="bg-blue-500 px-3 py-1 rounded">Pause</button>
<button onclick="resumeShift()" class="bg-green-500 px-3 py-1 rounded">Resume</button>
<button onclick="resetCurrent()" class="bg-yellow-500 px-3 py-1 rounded">Reset</button>
<button onclick="endShift()" class="bg-red-500 px-3 py-1 rounded">End</button>
</div>
</div>

<div class="card">
<div class="flex gap-2 flex-wrap">
<input id="shiftName" placeholder="Shift name" class="flex-1 p-2 rounded bg-white/10"/>
<button onclick="startShift()" class="bg-green-500 px-4 py-2 rounded">Start Shift</button>
</div>
</div>

<div class="card">
<h2>Pre-Book Shift (Next 2 Days)</h2>
<div class="flex gap-2 flex-wrap">
<input type="date" id="prebookDate" class="p-2 rounded bg-white/10"/>
<input type="time" id="prebookTime" class="p-2 rounded bg-white/10"/>
<button onclick="bookShift()" class="bg-purple-500 px-4 py-2 rounded">Book</button>
</div>
</div>

<div class="card">
<h2 class="mb-2">Shift History</h2>

<div class="flex gap-2 mb-3 flex-wrap">
 <input type="date" id="filterDate" class="p-2 rounded bg-white/10">
 <select id="filterTime" class="p-2 rounded bg-white/10">
  <option value="">All Time</option>
  <option value="morning">Morning (5‚Äì12)</option>
  <option value="afternoon">Afternoon (12‚Äì17)</option>
  <option value="evening">Evening (17‚Äì21)</option>
  <option value="night">Night (21‚Äì5)</option>
 </select>
 <button onclick="render()" class="bg-indigo-500 px-3 py-1 rounded">Apply</button>
</div>

<ul id="history" class="space-y-2"></ul>
</div>

<div class="card">
<h2>Charts</h2>
<canvas id="chart" class="w-full h-40 bg-white/10 rounded"></canvas>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyC6Luetvvg88KkrNvfJkaakTdwzBY8g3T4",
 authDomain: "work-and-finance-tracker.firebaseapp.com",
 projectId: "work-and-finance-tracker",
 storageBucket: "work-and-finance-tracker.appspot.com",
 messagingSenderId: "215242435368",
 appId: "1:215242435368:web:f9c3c521faf5db7e893e1d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

let shifts = JSON.parse(localStorage.getItem("shifts")||"[]");
let startTime=null,interval=null,paused=false,pausedAt=0;

const save=()=>{
 localStorage.setItem("shifts",JSON.stringify(shifts));
 if(auth.currentUser) setDoc(doc(db,"users",auth.currentUser.uid),{shifts});
};

window.googleLogin=()=>signInWithPopup(auth,provider);
window.logout=()=>signOut(auth);

onAuthStateChanged(auth, async user => {
 if (!user) {
  userInfo.innerText = "Not logged in";
  return;
 }

 userInfo.innerText = "Logged: " + user.email;

 const ref = doc(db, "users", user.uid);
 const snap = await getDoc(ref);

 if (snap.exists()) {
  const cloudShifts = snap.data().shifts || [];
  const local = shifts || [];

  const merged = [...cloudShifts, ...local].filter(
   (v, i, a) => a.findIndex(t => t.date === v.date && t.name === v.name) === i
  );

  shifts = merged;
  save();
 } else {
  await setDoc(ref, { shifts });
 }

 render();
});

const format=ms=>{
 let s=Math.floor(ms/1000);
 let h=String(Math.floor(s/3600)).padStart(2,'0');
 let m=String(Math.floor(s%3600/60)).padStart(2,'0');
 let sc=String(s%60).padStart(2,'0');
 return `${h}:${m}:${sc}`;
};

window.startShift=()=>{
 clearInterval(interval);
 paused=false;
 startTime=Date.now();
 active.classList.remove("hidden");
 interval=setInterval(()=>timer.innerText=format(Date.now()-startTime),1000);
};

window.pauseShift=()=>{
 if(paused)return;
 paused=true; pausedAt=Date.now(); clearInterval(interval);
};

window.resumeShift=()=>{
 if(!paused)return;
 startTime+=Date.now()-pausedAt;
 paused=false;
 interval=setInterval(()=>timer.innerText=format(Date.now()-startTime),1000);
};

window.resetCurrent=()=>{
 if(!startTime)return;
 startTime=Date.now(); timer.innerText="00:00:00";
};

window.endShift=()=>{
 clearInterval(interval);
 shifts.push({name:shiftName.value||"Work",duration:Date.now()-startTime,date:new Date().toISOString()});
 save(); active.classList.add("hidden"); render();
};

window.render = () => {
 history.innerHTML = "";
 let total = 0, today = 0;
 let t = new Date().toDateString();

const fd = document.getElementById("filterDate")?.value;
const ft = document.getElementById("filterTime")?.value;

let list = shifts.map((s, i) => ({ ...s, _i: i }));

if (fd) {
list = list.filter(s =>
new Date(s.date).toLocaleDateString('en-CA') === fd
 );
}

if (ft) {
 list = list.filter(s => {
  const h = new Date(s.date).getHours();
  if (ft === "morning") return h >= 5 && h < 12;
  if (ft === "afternoon") return h >= 12 && h < 17;
  if (ft === "evening") return h >= 17 && h < 21;
  if (ft === "night") return h >= 21 || h < 5;
  return true;
 });
}

 shifts.forEach(s => {
  total += s.duration;
  if (new Date(s.date).toDateString() === t) today += s.duration;
 });

 list.reverse().forEach(s => {
  history.innerHTML += `
  <li class="flex justify-between bg-white/10 p-2 rounded">
   <span>${s.name} ‚Äî ${format(s.duration)}</span>
   <span class="flex gap-2">
    <button onclick="editShift(${s._i})">‚úèÔ∏è</button>
    <button onclick="deleteShift(${s._i})">üóë</button>
   </span>
  </li>`;
 });

 totalShifts.innerText = shifts.length;
 totalTime.innerText = format(total);
 todayTime.innerText = format(today);

 drawChart();
};

window.editShift=i=>{
 let n=prompt("Edit shift name",shifts[i].name);
 if(n===null) return;
 let mins=prompt("Edit duration (minutes)",Math.round(shifts[i].duration/60000));
 if(mins===null) return;
 shifts[i].name=n;
 shifts[i].duration=Number(mins)*60000;
 save(); render();
};

window.deleteShift=i=>{
 if(confirm("Delete this shift?")){
  shifts.splice(i,1);
  save(); render();
 }
};

window.drawChart=()=>{
 const c=chart,ctx=c.getContext("2d");
 c.width=c.offsetWidth;c.height=160;
 ctx.clearRect(0,0,c.width,c.height);
 let d={},i=0;
 shifts.forEach(s=>{let k=new Date(s.date).getDate();d[k]=(d[k]||0)+s.duration});
 let m=Math.max(...Object.values(d),1);
 for(let k in d){
  let h=d[k]/m*(c.height-20);
  ctx.fillStyle="#8b5cf6";
  ctx.fillRect(20+i*30,c.height-h,20,h);
  i++;
 }
};

window.bookShift=()=>{
 const d=prebookDate.value;
 const t=prebookTime.value;
 if(!d||!t) return alert("Select date & time");

 const now=new Date();
 const sel=new Date(d+"T"+t);
 const diff=(sel-now)/(1000*60*60*24);

 if(diff<0 || diff>2) return alert("Only next 2 days allowed");

 localStorage.setItem("bookedShift",sel.toISOString());
 alert("Shift booked!");
};

setInterval(()=>{
 const b=localStorage.getItem("bookedShift");
 if(!b) return;
 const trg=new Date(b);
 const diff=(trg-new Date())/60000;
 if(diff<30 && diff>29 && Notification.permission==="granted"){
  new Notification("Upcoming Shift","Starts in 30 minutes");
 }
},30000);

if("Notification"in window) Notification.requestPermission();

render();
</script>

</body>
</html>


