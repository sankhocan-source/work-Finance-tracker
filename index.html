<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Work Schedule Tracker Pro</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Inter,sans-serif;background:linear-gradient(135deg,#0f0f1e,#1a1a2e);color:#fff}
.card{background:rgba(255,255,255,.08);backdrop-filter:blur(10px);border-radius:16px;padding:20px}
</style>
</head>

<body class="min-h-screen">
<div class="max-w-5xl mx-auto space-y-6 px-4 py-6">

<h1 class="text-3xl font-bold">Work Schedule Tracker ‚Äì Pro</h1>

<div class="card flex flex-col sm:flex-row gap-3 justify-between items-center">
<button onclick="resetCurrent()" class="bg-yellow-500 px-4 py-2 rounded w-full sm:w-auto">Reset Current Shift</button>
<div id="userInfo" class="opacity-80">Not logged in</div>
<div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
<button onclick="googleLogin()" class="bg-indigo-500 px-4 py-2 rounded">Google Login</button>
<button onclick="logout()" class="bg-red-500 px-4 py-2 rounded">Logout</button>
</div>
</div>

<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
<div class="card text-center"><p>Total Shifts</p><p id="totalShifts" class="text-2xl">0</p></div>
<div class="card text-center"><p>Total Time</p><p id="totalTime" class="text-2xl">00:00:00</p></div>
<div class="card text-center"><p>Today Time</p><p id="todayTime" class="text-2xl">00:00:00</p></div>
</div>

<div class="card">
<h2 class="mb-2 font-semibold">Productivity</h2>
<div class="grid grid-cols-3 text-center gap-3">
<div><p class="opacity-70">Score</p><p id="productivityScore">0%</p></div>
<div><p class="opacity-70">Streak</p><p id="streakCount">0 üî•</p></div>
<div><p class="opacity-70">Reward</p><p id="nextReward">Start</p></div>
</div>
</div>

<div id="active" class="card hidden">
<h2 class="font-semibold">Active Shift</h2>
<div id="timer" class="text-4xl">00:00:00</div>
<div class="flex flex-wrap gap-2 mt-3">
<button onclick="pauseShift()" class="bg-blue-500 px-3 py-1 rounded">Pause</button>
<button onclick="resumeShift()" class="bg-green-500 px-3 py-1 rounded">Resume</button>
<button onclick="resetCurrent()" class="bg-yellow-500 px-3 py-1 rounded">Reset</button>
<button onclick="endShift()" class="bg-red-500 px-3 py-1 rounded">End</button>
</div>
</div>

<div class="card">
<div class="flex flex-col sm:flex-row gap-2">
<input id="shiftName" placeholder="Shift name" class="flex-1 p-2 rounded bg-white/10"/>
<button onclick="startShift()" class="bg-green-500 px-4 py-2 rounded">Start Shift</button>
</div>
</div>

<div class="card">
<h2 class="font-semibold">Pre-Book Shift (Up to 2 Days Ahead)</h2>
<div class="flex flex-col sm:flex-row gap-2">
<input type="datetime-local" id="prebookTime" class="p-2 rounded bg-white/10 flex-1"/>
<button onclick="bookShift()" class="bg-purple-500 px-4 py-2 rounded">Book</button>
</div>
</div>

<div class="card">
<h2 class="font-semibold">Shift History</h2>
<ul id="history" class="space-y-2"></ul>
</div>

<div class="card">
<h2 class="font-semibold">Charts</h2>
<canvas id="chart" class="w-full h-40 bg-white/10 rounded"></canvas>
</div>

</div>

<script>
let shifts = JSON.parse(localStorage.getItem("shifts")||"[]");
let startTime=null,interval=null,paused=false,pausedAt=0;

const save=()=>localStorage.setItem("shifts",JSON.stringify(shifts));

const format=ms=>{
 let s=Math.floor(ms/1000);
 let h=String(Math.floor(s/3600)).padStart(2,'0');
 let m=String(Math.floor(s%3600/60)).padStart(2,'0');
 let sc=String(s%60).padStart(2,'0');
 return `${h}:${m}:${sc}`;
};

function startShift(){
 clearInterval(interval);
 paused=false;
 startTime=Date.now();
 active.classList.remove("hidden");
 interval=setInterval(()=>timer.innerText=format(Date.now()-startTime),1000);
}

function pauseShift(){
 if(paused) return;
 paused=true; pausedAt=Date.now(); clearInterval(interval);
}

function resumeShift(){
 if(!paused) return;
 startTime+=Date.now()-pausedAt;
 paused=false;
 interval=setInterval(()=>timer.innerText=format(Date.now()-startTime),1000);
}

function resetCurrent(){
 if(!startTime) return;
 startTime=Date.now(); timer.innerText="00:00:00";
}

function endShift(){
 clearInterval(interval);
 shifts.push({name:shiftName.value||"Work",duration:Date.now()-startTime,date:new Date().toISOString()});
 save(); active.classList.add("hidden"); render(); notify("Saved","Nice work!");
}

function render(){
 history.innerHTML="";
 let total=0,today=0,todayStr=new Date().toDateString();

 shifts.slice().reverse().forEach((s,idx)=>{
  let i=shifts.length-1-idx;
  total+=s.duration;
  if(new Date(s.date).toDateString()===todayStr) today+=s.duration;

  history.innerHTML+=`
   <li class="flex justify-between bg-white/10 p-2 rounded">
    <span>${s.name} ‚Äî ${format(s.duration)}</span>
    <span class="flex gap-2">
     <button onclick="editShift(${i})">‚úèÔ∏è</button>
     <button onclick="deleteShift(${i})">üóë</button>
    </span>
   </li>`;
 });

 totalShifts.innerText=shifts.length;
 totalTime.innerText=format(total);
 todayTime.innerText=format(today);
 calcStats();
 drawChart();
}

function editShift(i){
 let s=shifts[i];
 let name=prompt("Edit name",s.name);
 let mins=prompt("Edit duration (minutes)",Math.round(s.duration/60000));
 let date=prompt("Edit date (YYYY-MM-DD HH:MM)",s.date.replace("T"," ").slice(0,16));
 if(name&&mins&&date){
  s.name=name;
  s.duration=Number(mins)*60000;
  s.date=new Date(date.replace(" ","T")).toISOString();
  save(); render();
 }
}

function deleteShift(i){
 if(confirm("Delete this shift?")){
  shifts.splice(i,1); save(); render();
 }
}

function drawChart(){
 const c=chart,ctx=c.getContext("2d");
 c.width=c.offsetWidth;c.height=160;
 ctx.clearRect(0,0,c.width,c.height);
 let d={},i=0;
 shifts.forEach(s=>{let k=new Date(s.date).getDate();d[k]=(d[k]||0)+s.duration});
 let m=Math.max(...Object.values(d),1);
 for(let k in d){
  let h=d[k]/m*(c.height-20);
  ctx.fillStyle="#8b5cf6";
  ctx.fillRect(20+i*30,c.height-h,20,h);
  i++;
 }
}

function calcStats(){
 let today=new Date().toDateString(),ms=0;
 shifts.forEach(s=>{if(new Date(s.date).toDateString()===today)ms+=s.duration});
 let hrs=ms/3600000;
 productivityScore.innerText=Math.min(100,Math.round(hrs/8*100))+"%";
 streakCount.innerText=Math.floor(hrs)+" üî•";
 nextReward.innerText=hrs>=8?"üèÜ Champion":hrs>=6?"ü•á Gold":hrs>=4?"ü•à Silver":hrs>=2?"ü•â Bronze":"Start";
}

function bookShift(){
 let v=prebookTime.value;
 if(!v) return alert("Pick date & time");
 let diff=(new Date(v)-Date.now())/86400000;
 if(diff>2) return alert("Only up to 2 days ahead allowed");
 localStorage.setItem("bookedShift",v);
 alert("Shift booked!");
}

setInterval(()=>{
 let b=localStorage.getItem("bookedShift");
 if(!b) return;
 let diff=(new Date(b)-Date.now())/60000;
 if(diff<30&&diff>29) notify("Upcoming Shift","Starts in 30 minutes");
},30000);

function notify(t,b){
 if(Notification.permission==="granted") new Notification(t,{body:b});
}

if("Notification"in window) Notification.requestPermission();

render();
</script>

</body>
</html>
